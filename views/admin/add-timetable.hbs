<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Timetable</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #34495e;
            --accent-color: #3498db;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --danger-color: #e74c3c;
            --light-bg: #f8f9fa;
            --card-bg: #ffffff;
            --border-color: #eef2f7;
            --text-primary: #2c3e50;
            --text-secondary: #7f8c8d;
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.12);
        }

        body {
            background-color: #f5f7fb;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            color: var(--text-primary);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
        }

        /* Header Section */
        .page-header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 2.5rem 0;
            margin-bottom: 2.5rem;
            border-radius: 0 0 12px 12px;
            box-shadow: var(--shadow-md);
        }

        .page-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .page-subtitle {
            color: rgba(255, 255, 255, 0.85);
            font-size: 1rem;
            margin-bottom: 0;
        }

        /* Cards */
        .card {
            border: none;
            border-radius: 12px;
            box-shadow: var(--shadow-sm);
            margin-bottom: 1.5rem;
            background: var(--card-bg);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            overflow: hidden;
        }

        .card:hover {
            box-shadow: var(--shadow-md);
        }

        .card-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            font-weight: 600;
            font-size: 1.1rem;
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-header i {
            font-size: 1.1em;
        }

        .card-body {
            padding: 1.75rem;
        }

        /* Form Elements */
        .form-label {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
        }

        .form-control, .form-select {
            border: 1.5px solid var(--border-color);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            font-size: 0.95rem;
            transition: all 0.2s ease;
            background-color: white !important;
            color: var(--text-primary) !important;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.15);
            outline: none;
        }

        .required-asterisk {
            color: var(--danger-color);
            font-weight: bold;
            margin-left: 2px;
        }

        /* Row Container */
        .rows-container {
            display: grid;
            gap: 1.5rem;
        }

        .row-item {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
            position: relative;
            transition: all 0.3s ease;
        }

        .row-item:hover {
            border-color: var(--accent-color);
            box-shadow: var(--shadow-md);
        }

        .row-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .row-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            color: var(--primary-color);
        }

        .row-number {
            background: var(--accent-color);
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .remove-row-btn {
            background: rgba(231, 76, 60, 0.1);
            color: var(--danger-color) !important;
            border: 1px solid rgba(231, 76, 60, 0.2);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .remove-row-btn:hover {
            background: var(--danger-color);
            color: white !important;
            border-color: var(--danger-color);
            transform: translateY(-1px);
        }

        /* Form Grid */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.25rem;
        }

        .form-grid .form-group {
            margin-bottom: 0;
        }

        /* Buttons */
        .btn-add-row {
            background: linear-gradient(135deg, var(--success-color), #2ecc71);
            color: white !important;
            border: none;
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(39, 174, 96, 0.2);
        }

        .btn-add-row:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(39, 174, 96, 0.3);
        }

        .btn-save {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white !important;
            border: none;
            border-radius: 10px;
            padding: 0.875rem 2.5rem;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-md);
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 200px;
        }

        .btn-save:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .btn-back {
            background: transparent;
            color: white !important;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 0.625rem 1.5rem;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-back:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .btn-reset {
            background: transparent;
            color: var(--text-secondary) !important;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 0.75rem 2rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .btn-reset:hover {
            background: rgba(127, 140, 141, 0.05);
            border-color: var(--text-secondary);
        }

        /* Info Badge */
        .info-badge {
            background: rgba(52, 152, 219, 0.08);
            color: var(--accent-color);
            padding: 0.875rem 1.25rem;
            border-radius: 8px;
            font-size: 0.95rem;
            margin-bottom: 1.5rem;
            border-left: 4px solid var(--accent-color);
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .info-badge i {
            margin-top: 2px;
        }

        /* Textarea */
        textarea.form-control {
            min-height: 120px;
            line-height: 1.6;
            resize: vertical;
            font-family: inherit;
        }

        /* Footer Actions */
        .form-actions {
            background: white;
            padding: 1.75rem;
            border-radius: 12px;
            box-shadow: var(--shadow-sm);
            margin-top: 2.5rem;
            border-top: 1px solid var(--border-color);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .page-header {
                padding: 2rem 1rem;
                margin: 0 -1rem 2rem;
                border-radius: 0;
            }
            
            .page-title {
                font-size: 1.75rem;
            }
            
            .card-body {
                padding: 1.5rem 1.25rem;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .row-item {
                padding: 1.25rem;
            }
            
            .btn-save, .btn-reset {
                width: 100%;
                justify-content: center;
                margin-bottom: 0.75rem;
            }
            
            .form-actions {
                padding: 1.5rem;
            }
        }

        @media (min-width: 992px) {
            .form-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        /* Input Focus States */
        input:focus, select:focus, textarea:focus {
            outline: none;
        }

        /* Date Input */
        input[type="date"] {
            position: relative;
            color: var(--text-primary) !important;
        }

        input[type="date"]::-webkit-calendar-picker-indicator {
            opacity: 0.6;
            cursor: pointer;
        }

        /* Number Input */
        input[type="number"] {
            -moz-appearance: textfield;
        }

        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* Animation for new rows */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .row-item.new-row {
            animation: fadeIn 0.4s ease-out;
        }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
        }

        .empty-state i {
            font-size: 3rem;
            color: var(--border-color);
            margin-bottom: 1rem;
        }
    </style>

</head>

<body>
   

    <!-- Page Header -->
    <div class="page-header">
        <div class="container">
            <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center">
                <div>
                    <h1 class="page-title">
                        <i class="fas fa-calendar-plus"></i>
                        Create Examination Timetable
                    </h1>
                    <p class="page-subtitle">Design a comprehensive exam schedule with multiple entries</p>
                </div>
                <div class="mt-3 mt-md-0">
                    <a href="/user/view-tbatch" class="btn btn-back">
                        <i class="fas fa-arrow-left me-2"></i> Back to Timetables
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <form action="/user/save-timetable" method="POST" id="timetableForm">
            <!-- Batch Selection -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-users"></i> Batch Information
                </div>
                <div class="card-body">
                    <div class="info-badge">
                        <i class="fas fa-info-circle"></i>
                        <div>Select the batch for which you're creating the examination timetable. This will associate the schedule with the correct student group.</div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 col-lg-4">
                            <div class="form-group">
                                <label class="form-label">Select Batch <span class="required-asterisk">*</span></label>
                                <select class="form-select" name="batchId" required>
                                    <option value="">-- Choose a batch --</option>
                                    {{#each batches}}
                                    <option value="{{this._id}}">{{this.batchName}} </option>
                                    {{/each}}
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Timetable Details -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-clipboard-check"></i> Timetable Details
                </div>
                <div class="card-body">
                    {{!-- <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Course Name <span class="required-asterisk">*</span></label>
                            <input type="text" class="form-control" name="courseName" 
                                   placeholder="e.g., Diploma in Pharmacy" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Semester Title <span class="required-asterisk">*</span></label>
                            <input type="text" class="form-control" name="semesterTitle" 
                                   placeholder="e.g., IVth Semester Examination" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Exam Month & Year <span class="required-asterisk">*</span></label>
                            <input type="text" class="form-control" name="examMonthYear" 
                                   placeholder="e.g., August 2025" required>
                        </div>
                        
                    </div> --}}
                     <div class="form-group">
                            <label class="form-label">First Title <span class="required-asterisk">*</span></label>
                            <input type="text" class="form-control" name="firstTitle" 
                                    required>
                        </div>
                         <div class="form-group">
                            <label class="form-label">Second Title <span class="required-asterisk">*</span></label>
                            <input type="text" class="form-control" name="secondTitle" 
                                  required>
                        </div>
                </div>
            </div>

            <!-- Exam Schedule -->
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <div>
                        <i class="fas fa-calendar-day"></i> Exam Schedule
                    </div>
                    <button type="button" class="btn btn-add-row" id="addRowBtn">
                        <i class="fas fa-plus"></i> Add Exam Entry
                    </button>
                </div>

                <div class="card-body">
                    <div class="info-badge">
                        <i class="fas fa-lightbulb"></i>
                        <div>Add individual exam entries. Each entry represents one exam session. You can add as many as needed.</div>
                    </div>

                    <div class="rows-container" id="rowsContainer">
                        <!-- Default Row -->
                        <div class="row-item">
                            <div class="row-header">
                                <div class="row-title">
                                    <span class="row-number">1</span>
                                    <span>Exam Entry</span>
                                </div>
                                <button type="button" class="btn remove-row-btn" data-remove-row>
                                    <i class="fas fa-trash"></i>
                                    <span class="d-none d-md-inline">Remove</span>
                                </button>
                            </div>
                            
                            <div class="form-grid">
                                <div class="form-group">
                                    <label class="form-label">Sr. No.</label>
                                    <input type="number" class="form-control" name="srNo[]" 
                                           placeholder="1" min="1" value="1" required>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Date <span class="required-asterisk">*</span></label>
                                    <input type="date" class="form-control" name="date[]" required>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Time <span class="required-asterisk">*</span></label>
                                    <input type="text" class="form-control" name="time[]" 
                                           placeholder="02:00 PM to 05:00 PM" required>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Course <span class="required-asterisk">*</span></label>
                                    <input type="text" class="form-control" name="course[]" 
                                           placeholder="DMLT / DPhA2" required>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Year <span class="required-asterisk">*</span></label>
                                    <input type="number" class="form-control" name="year[]" 
                                             required>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Semester <span class="required-asterisk">*</span></label>
                                    <input type="text" class="form-control" name="sem[]" 
                                           placeholder="IV" required>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Paper Name <span class="required-asterisk">*</span></label>
                                    <input type="text" class="form-control" name="paperName[]" 
                                           placeholder="Pharmacology - IV" required>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Notes Section -->
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-sticky-note"></i> Additional Notes
                </div>
                <div class="card-body">
                    <label class="form-label">Instructions & Notes (Optional)</label>
                    <div class="info-badge mb-3">
                        <i class="fas fa-edit"></i>
                        <div>These notes will appear at the bottom of the timetable for student reference.</div>
                    </div>
                    
                    <textarea class="form-control" name="notes" rows="5" 
                              placeholder="Enter important instructions for students...">
1. Candidate should note the dates and sequence carefully.
2. If a holiday occurs, exams will continue as per schedule.
3. The examination board reserves the right to change the schedule if necessary.
4. Students must bring their admission tickets and ID cards.
5. Mobile phones and electronic devices are not permitted in the examination hall.
                    </textarea>
                    
                    <div class="text-muted mt-3">
                        <small><i class="fas fa-exclamation-circle me-1"></i> Use clear, concise points for better readability</small>
                    </div>
                </div>
            </div>

            <!-- Form Actions -->
            <div class="form-actions">
                <div class="d-flex flex-column flex-md-row justify-content-between align-items-center">
                    <div class="mb-3 mb-md-0">
                        <p class="mb-0 text-muted">
                            <i class="fas fa-shield-alt me-1"></i>
                            All information will be securely stored
                        </p>
                    </div>
                    <div class="d-flex flex-column flex-md-row gap-3">
                        <button type="reset" class="btn btn-reset">
                            <i class="fas fa-redo me-2"></i> Reset Form
                        </button>
                        <button type="submit" class="btn btn-save">
                            <i class="fas fa-save me-2"></i> Save Timetable
                        </button>
                    </div>
                </div>
            </div>
        </form>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const addRowBtn = document.getElementById("addRowBtn");
            const rowsContainer = document.getElementById("rowsContainer");
            
            // Update all row numbers
            function updateRowNumbers() {
                const rows = rowsContainer.querySelectorAll('.row-item');
                rows.forEach((row, index) => {
                    const rowNumber = row.querySelector('.row-number');
                    const srNoInput = row.querySelector('input[name="srNo[]"]');
                    
                    if (rowNumber) {
                        rowNumber.textContent = index + 1;
                    }
                    if (srNoInput) {
                        srNoInput.value = index + 1;
                    }
                });
            }
            
            // Add new row
            addRowBtn.addEventListener('click', function() {
                const firstRow = rowsContainer.querySelector('.row-item');
                const newRow = firstRow.cloneNode(true);
                
                // Clear all inputs in new row
                newRow.querySelectorAll('input').forEach(input => {
                    if (input.type === 'date') {
                        input.value = '';
                    } else if (input.name === 'srNo[]') {
                        // Will be set by updateRowNumbers
                    } else if (input.type !== 'number' || input.name === 'year[]') {
                        input.value = '';
                    }
                });
                
                // Add new row class for animation
                newRow.classList.add('new-row');
                
                // Add to container
                rowsContainer.appendChild(newRow);
                
                // Update row numbers
                updateRowNumbers();
                
                // Scroll to new row
                newRow.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                
                // Remove animation class after animation completes
                setTimeout(() => {
                    newRow.classList.remove('new-row');
                }, 400);
            });
            
            // Remove row
            rowsContainer.addEventListener('click', function(e) {
                if (e.target.closest('[data-remove-row]')) {
                    const rows = rowsContainer.querySelectorAll('.row-item');
                    const rowToRemove = e.target.closest('.row-item');
                    
                    if (rows.length > 1) {
                        // Add removal animation
                        rowToRemove.style.opacity = '0';
                        rowToRemove.style.transform = 'translateX(-20px)';
                        
                        setTimeout(() => {
                            rowToRemove.remove();
                            updateRowNumbers();
                        }, 300);
                    } else {
                        // Show warning for last row
                        showToast('You must have at least one exam entry.', 'warning');
                    }
                }
            });
            
            // Form validation
            const form = document.getElementById('timetableForm');
            form.addEventListener('submit', function(e) {
                // Check for empty date inputs
                const dateInputs = form.querySelectorAll('input[type="date"]');
                let hasEmptyDates = false;
                
                dateInputs.forEach(input => {
                    if (!input.value.trim()) {
                        hasEmptyDates = true;
                        input.style.borderColor = 'var(--danger-color)';
                    }
                });
                
                if (hasEmptyDates) {
                    e.preventDefault();
                    showToast('Please fill in all date fields.', 'error');
                }
            });
            
            // Clear error styling on date input focus
            rowsContainer.addEventListener('focus', function(e) {
                if (e.target.type === 'date') {
                    e.target.style.borderColor = '';
                }
            }, true);
            
            // Initialize row numbers
            updateRowNumbers();
            
            // Toast notification function
            function showToast(message, type = 'info') {
                // Create toast element
                const toast = document.createElement('div');
                toast.className = `toast-notification toast-${type}`;
                toast.innerHTML = `
                    <div class="toast-content">
                        <i class="fas ${type === 'error' ? 'fa-exclamation-circle' : type === 'warning' ? 'fa-exclamation-triangle' : 'fa-info-circle'}"></i>
                        <span>${message}</span>
                    </div>
                `;
                
                // Add styles
                toast.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: ${type === 'error' ? '#e74c3c' : type === 'warning' ? '#f39c12' : '#2c3e50'};
                    color: white;
                    padding: 1rem 1.5rem;
                    border-radius: 8px;
                    box-shadow: var(--shadow-lg);
                    z-index: 9999;
                    animation: slideIn 0.3s ease;
                    max-width: 400px;
                `;
                
                // Add to body
                document.body.appendChild(toast);
                
                // Remove after 3 seconds
                setTimeout(() => {
                    toast.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => {
                        if (toast.parentNode) {
                            toast.parentNode.removeChild(toast);
                        }
                    }, 300);
                }, 3000);
            }
            
            // Add CSS for toast animations
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
        });
    </script>

</body>
</html>