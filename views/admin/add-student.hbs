<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Students</title>
    <link rel="stylesheet" href="/stylesheets/sform.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
     <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
   
</head>
<body>
  
    <div class="container">
        <div class="header" >
            <div class="left-head">
       
    </div>
            <div class="right-head">
               
            </div>
        </div>
       
        <div class="full-width-image-container">
  
</div>
        <div class="content">
          <div class="page1">
            <img src="/images/title.jpg" alt="Title" class="full-width-image" />
            
           <div class="heading-wrapper">
  <h2 class="main-heading">CANDIDATE ADMISSION-CUM-EXAMINATION FORM</h2>
</div>

            <h3>Note:All entries must be filled by the candidate in captal letters</h3>
            
            <form  id="studentForm" action="/admin/add-student" method="POST" enctype="multipart/form-data">
                 <!-- Academic Details -->
      <h2><i class="fa-solid fa-building-columns"></i> Academic Details</h2>
       

      <div class="form-row" >
        
        <div class="form-group" style="padding-top: 100px;">
          <label>Admission Year</label>
          <input type="number" name="admissionYear">
        </div>
        <div class="form-group" style="padding-top: 100px;">
          <label>Mode</label>
          <select name="mode">
            <option>select</option>
            <option>Regular</option>
            <option>Distance</option>
            <option>Online</option>
          </select>
        </div>
        <div class="photo-box">
  <label for="imageUpload" class="photo-label"></label>
  <input type="file" accept="image/*" id="imageUpload" name="image" onchange="previewPhoto(event)" style="display: none;">
  <div class="photo-preview" id="photoPreviewBox">
    <img id="previewImage" src="" alt="Photo Upload" style="max-width: 100%; max-height: 100%;">
  </div>
</div>
       
        
      </div>

      <div class="form-row">
         <div class="form-group">
          <label>ATC (Centre)</label>
           <input type="text" name="centreId" id="centreId" value="{{centreId}}" >
        </div>
        <div class="form-group">
  <label>Course Name</label>
  <select name="courseName" class="form-control" required>
    <option value="">-- Select Course --</option>

    {{#each courseNames}}
      <option value="{{this}}">{{this}}</option>
    {{/each}}

  </select>
</div>

        <div class="form-group">
          <label>Course Code</label>
          <input type="text" name="courseCode">
        </div>
        
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Short Name</label>
          <input type="text" name="shortName">
        </div>
        <div class="form-group">
          <label>Course Duration</label>
          <input type="text" name="courseDuration">
        </div>
        <div class="form-group">
          <label>Medium</label>
          <input type="text" name="medium">
        </div>
        
      </div>

      <div class="form-row">
  <div class="form-group">
    <label>Course Department</label>
<select name="department" id="department">
  <option value="">Select Department</option>
  {{#if centre.department}}
    <option value="{{centre.department}}" selected>{{centre.department}}</option>
  {{/if}}
  <option value="Department of Paramedical Education">Department of Paramedical Education</option>
  <option value="Mobile Phone Technology">Mobile Phone Technology</option>
</select>


  </div>
  <div class="form-group">
            <label for="batchId">Admission Batch</label>
<select name="batchId" id="batchId" required>
  <option value="">Select</option>
  {{#each batches}}
    <option value="{{this._id}}">{{this.batchName}} ({{this.batchId}})</option>
  {{/each}}
</select>


          
        </div>
</div>


      <!-- Personal Details -->
      <h2><i class="fa-solid fa-circle-user"></i> Personal Details</h2>
     

      <div class="form-row">
        <div class="form-group">
          <label>Student Reg. No.</label>
          <input type="text" name="regNo">
        </div>
        <div class="form-group">
          <label>Full Name</label>
          <input type="text" name="fullName">
        </div>
      


        <div class="form-group">
          <label>Mother Name</label>
          <input type="text" name="motherName">
        </div>
      </div>
       
      
      <div class="form-row">
        <div class="form-group">
          <label>Father Name</label>
          <input type="text" name="fatherName">
        </div>
        <div class="form-group">
          <label>Father Occupation</label>
          <input type="text" name="fatherOcc">
        </div>
        <div class="form-group">
          <label>Candidate Occupation</label>
          <input type="text" name="candOcc">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Gender</label>
          <select name="gender">
            <option>select</option>
            <option>Male</option>
            <option>Female</option>
            <option>Other</option>
          </select>
        </div>
        <div class="form-group">
          <label>Date of Birth</label>
          <input type="date" name="dob">
        </div>
        <div class="form-group">
          <label>Contact Number</label>
          <input type="number" name="number">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Emergency Number</label>
          <input type="number" name="emerNum">
        </div>
        <div class="form-group">
          <label>Email</label>
          <input type="email" name="email">
        </div>
        <div class="form-group">
          <label>BPL</label>
          <select name="bpl">
            <option>select</option>
            <option>Yes</option>
            <option>No</option>
          </select>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>PH</label>
          <select name="ph">
            <option>select</option>
            <option>Yes</option>
            <option>No</option>
          </select>
        </div>
        <div class="form-group">
          <label>Caste Category</label>
          <select name="caste">
            <option>select category</option>
            <option>Gen</option>
            <option>OBC</option>
            <option>SC</option>
            <option>ST</option>
            <option>Other</option>
          </select>
        </div>
        <div class="form-group">
          <label>Aadhar Number</label>
          <input type="number" name="adharNo">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>Address</label>
          <input type="text" name="address">
        </div>
        <div class="form-group">
          <label>Pin Code</label>
          <input type="number" name="pinCode">
        </div>
        <div class="form-group">
          <label>City</label>
          <input type="text" name="city">
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>District</label>
          <input type="text" name="district">
        </div>
        <div class="form-group">
          <label>State</label>
          <input type="text" name="state">
        </div>
        <div class="form-group">
          <label>Nationality</label>
          <input type="text" name="nationality">
        </div>
      </div>

 </div>
 <div class="page-break"></div>
     <div id="page2" style=" padding: 20px; font-family: Arial, sans-serif; margin-top: 30px;" class="page2">
      <!-- Qualification Details -->
      <h2><i class="fa-solid fa-medal"></i> Qualification Details</h2>
      <div class="table-container">
        <table class="qualification-table">
  <thead>
    <tr>
      <th>Education</th>
      <th>Max Marks</th>
      <th>Min Marks</th>
      <th>Obtained Marks</th>
      <th>Grade-%</th>
      <th>Year</th>
      <th>Board/University/Organisation</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody id="qualificationBody">
    <tr>
      <td>
        <select name="education[]">
          <option value="">Select</option>
          <option value="10th">10th Standard</option>
          <option value="12th">12th Standard</option>
          <option value="diploma">Diploma</option>
          <option value="ug">Undergraduate</option>
          <option value="pg">Postgraduate</option>
        </select>
      </td>
      <td><input type="number" name="maxMarks[]" placeholder="0"></td>
      <td><input type="number" name="minMarks[]" placeholder="0"></td>
      <td><input type="number" name="obtainedMarks[]" placeholder="Obtained"></td>
      <td><input type="text" name="grade[]" placeholder="A/90%"></td>
      <td><input type="number" name="year[]" placeholder="YYYY"></td>
      <td><input type="text" name="board[]" placeholder="Board name"></td>
      <td>
        <button type="button" class="add-row-btn">
          <i class="fas fa-plus-circle"></i> Add
        </button>
      </td>
    </tr>
  </tbody>
</table>
<p style="padding-top: 10px;"><b>Enclosure : </b>  Demand Draft/DD/Online Pay Slip , Self-Attested Xerox Copy of All Qualification & Cast Certificate</p>
      </div>
      

  <!-- DECLARATION BY THE APPLICANT -->
  <h3 style="
    text-align: center;
    background: #eaeaea;
    padding: 6px;
    border: 1px solid #bbb;
    font-weight: bold;
  " class="h3-app">DECLARATION BY THE APPLICANT</h3>

  <p style="font-size: 16px; line-height: 1.5; text-align: justify;">
    I ............................................................. Son/Daughter of ............................................................. hereby declare
    that I read all the rules and regulations of the institute and I am committed to follow all the rules with best of
    my efforts. If found any violation then the institute authority has the rights to terminate my registration. In case
    of termination the institute will not be responsible for any fee return or any kind of claim.
  </p>

  <p style="font-size: 16px; line-height: 1.5; text-align: justify;">
    I also declare of my knowledge.
  </p>

  <!-- DATE & PLACE -->
  <div style="display: flex; justify-content: space-between; margin-top: 30px;">
    <div>
      <b>Date:</b> _____ / _____ / 20_____
      <br><br>
      <b>Place:</b> __________________________________
    </div>

    <div style="text-align: center;">
      <p style="margin-bottom: 40px;"><b>Signature of Applicant</b></p>
    </div>

    <div style="text-align: center;">
      <p style="margin-bottom: 40px;"><b>Signature of Guardian</b></p>
    </div>

    <div style="text-align: center;">
      <p style="margin-bottom: 40px;"><b>Signature of ATC Director<br><small>With rubber stamp and date</small></b></p>
    </div>
  </div>

  <hr style="margin: 40px 0; border: none; border-top: 2px solid #000;">

  <!-- HEAD OFFICE USE ONLY -->
  <h3 style="
    text-align: center;
    background: #eaeaea;
    padding: 6px;
    border: 1px solid #bbb;
    font-weight: bold;
  ">TRAINING CENTER USE ONLY</h3>

  <div style="display: flex; justify-content: space-between; margin-top: 25px;">
    <div style="text-align: center; flex: 1;">
      <b>Form Receiving Date</b>
      <div style="border: 1px solid #000; height: 40px; margin-top: 5px;"></div>
    </div>

    <div style="text-align: center; flex: 1;">
      <b>Enrollment No.</b>
      <div style="border: 1px solid #000; height: 40px; margin-top: 5px;"></div>
    </div>

    <div style="text-align: center; flex: 1;">
      <b>Authorised Signatory</b>
      <div style="border: 1px solid #000; height: 40px; margin-top: 5px;"></div>
    </div>
  </div>

</div>
      
    


      

      <br>
      <input class="submit-btn" type="submit" value="Submit">
    <button type="button" id="downloadPdf" class="btn btn-danger">
  Preview Download
</button>


    </form>
   
            
            
       </div>     
        
    </div>
   


    <script>
document.addEventListener("click", function (e) {
  if (e.target.closest(".add-row-btn")) {
    let tbody = document.getElementById("qualificationBody");
    let newRow = tbody.rows[0].cloneNode(true);

    // clear inputs
    newRow.querySelectorAll("input, select").forEach(el => el.value = "");

    // change button to remove
    let actionCell = newRow.querySelector("td:last-child");
    actionCell.innerHTML = `
      <button type="button" class="remove-row-btn">
        <i class="fas fa-minus-circle"></i> Remove
      </button>
    `;

    tbody.appendChild(newRow);
  }

  if (e.target.closest(".remove-row-btn")) {
    let row = e.target.closest("tr");
    row.remove();
  }
});
function previewPhoto(event) {
  const file = event.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      document.getElementById("previewImage").src = e.target.result;
    };
    reader.readAsDataURL(file);
  }
}
// Trigger file input when clicking the preview box
document.getElementById('photoPreviewBox').addEventListener('click', function() {
  document.getElementById('imageUpload').click();
});

</script>
<script>
async function downloadPDF() {
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF("p", "mm", "a4");
  const pageWidth = pdf.internal.pageSize.getWidth();
  const pageHeight = pdf.internal.pageSize.getHeight();

  const page1Element = document.querySelector(".page1");

  // PAGE 1
  const canvas1 = await html2canvas(page1Element, { scale: 1 });
  const imgData1 = canvas1.toDataURL("image/png");
  const imgHeight1 = (canvas1.height * pageWidth) / canvas1.width;
  pdf.addImage(imgData1, "PNG", 0, 0, pageWidth, imgHeight1);

  // PAGE 2
  pdf.addPage();
  const page2Element = document.getElementById("page2");
  const canvas2 = await html2canvas(page2Element, {
    scale: 1,
    width: page1Element.scrollWidth,
    windowWidth: page1Element.scrollWidth
  });
  const imgWidth2 = pageWidth * 0.96;
  const imgHeight2 = (canvas2.height * imgWidth2) / canvas2.width;
  const xOffset2 = (pageWidth - imgWidth2) / 2;
  const imgData2 = canvas2.toDataURL("image/png");
  pdf.addImage(imgData2, "PNG", xOffset2, 0, imgWidth2, imgHeight2);

  // PAGE 3
  const img1 = new Image();
  img1.src = "/images/sdeclare.jpg";
  await new Promise(resolve => (img1.onload = resolve));
  pdf.addPage();
  pdf.addImage(img1, "JPEG", 0, 0, pageWidth, pageHeight);

  // PAGE 4
  const img2 = new Image();
  img2.src = "/images/pdeclare.jpg";
  await new Promise(resolve => (img2.onload = resolve));
  pdf.addPage();
  pdf.addImage(img2, "JPEG", 0, 0, pageWidth, pageHeight);

  // SAVE
  pdf.save("student-application-form.pdf");
}

// Download button click
document.getElementById("downloadPdf").addEventListener("click", function () {
  downloadPDF();
});

// Form submit -> download PDF -> THEN submit form
document.getElementById("studentForm").addEventListener("submit", async function (e) {
  e.preventDefault(); // stop immediate submit
  await downloadPDF(); // wait until PDF downloads
  this.submit(); // now submit real form
});
</script>

   
</body>
</html>